## 表达
表达（Representation）指的是如何显示地对事物建模。

### 分布
考虑3个随机变量，每一个变量可选值如如下：

Intelligence(I) -- $i^{0}$ (low), $i^{1}$ (high)

Difficulty(D) -- $d^{0}$ (easy), $d^{1}$ (hard)

Grade(G) -- $g^{1}$ (A), $g^{2}$ (B), $g^{3}$ (C)

联合分布（Joint Distribution）$P(I, D, G)$ 如下

| I | D | G | Prob |
| :----: | :----: | :----: | :----: |
| $i^{0}$ | $d^{0}$ | $g^{1}$ | 0.126 |
| $i^{0}$ | $d^{0}$ | $g^{2}$ | 0.168 |
| $i^{0}$ | $d^{0}$ | $g^{3}$ | 0.126 |
| $i^{0}$ | $d^{1}$ | $g^{1}$ | 0.009 |
| $i^{0}$ | $d^{1}$ | $g^{2}$ | 0.045 |
| $i^{0}$ | $d^{1}$ | $g^{3}$ | 0.126 |
| $i^{1}$ | $d^{0}$ | $g^{1}$ | 0.252 |
| $i^{1}$ | $d^{0}$ | $g^{2}$ | 0.0224 |
| $i^{1}$ | $d^{0}$ | $g^{3}$ | 0.0056 |
| $i^{1}$ | $d^{1}$ | $g^{1}$ | 0.06 |
| $i^{1}$ | $d^{1}$ | $g^{2}$ | 0.036 |
| $i^{1}$ | $d^{1}$ | $g^{3}$ | 0.024 |

条件概率（Conditional probability）$P(I, D \mid g^{1})$

| I | D | Prob |
| :----: | :----: | :----: |
| $i^{0}$ | $d^{0}$ | 0.282 |
| $i^{0}$ | $d^{1}$ | 0.02 |
| $i^{1}$ | $d^{0}$ | 0.564 |
| $i^{1}$ | $d^{1}$ | 0.134 |

边缘化（Marginalization）

$$
\sum_{I} P(I, D) = P(D)
$$

| D | Prob |
| :----: | :----: |
| $d^{0}$ | 0.846 |
| $d^{1}$ | 0.154 |

### 因子
因子（factor）是一种对高纬分布的基础表达形式，如 $\phi(X_{1}, \cdots, X_{k})$，这里 $\phi$ 表示在随机变量取某一🈯值后的因子值 $Val(X_{1}, \cdots, X_{k}) \rightarrow R$

因子的**值域（Scope）** $\{ X_{1}, \cdots, X_{k} \}$

因子相乘 $\phi(A, B, C) \cdot \phi(C, D)$ 后的值域 {A, B, C, D} 其中 P(I, D, G) 和 P(I, D, $g^{1}$) 都是因子。

#### 因子相乘
假设 X，Y 和 Z 是二值变量，$\phi_1(X,Y)$ 和 $\phi_2(Y, Z)$ 是两个因子如下

| X | Y | $\phi_{1}(X, Y)$ |
| :----: | :----: | :----: |
| 1 | 1 | 0.8 |
| 1 | 2 | 0.5 |
| 2 | 1 | 0.5 |
| 2 | 2 | 0.6 |

| Y | Z | $\phi_{2}(Y, Z)$ |
| :----: | :----: | :----: |
| 1 | 1 | 0.2 |
| 1 | 2 | 0.2 |
| 2 | 1 | 0.9 |
| 2 | 2 | 1.0 |

两个因子的乘积得到新因子 $\psi(X, Y, Z) = \phi_1(X,Y) \cdot \phi_2(Y, Z)$ 如下

| X | Y | Z | $\psi(X, Y, Z)$ |
| :----: | :----: | :----: | :----: |
| 1 | 1 | 1 | 0.16 |
| 1 | 1 | 2 | 0.16 |
| 1 | 2 | 1 | 0.45 |
| 1 | 2 | 2 | 0.5 |
| 2 | 1 | 1 | 0.1 |
| 2 | 1 | 2 | 0.1 |
| 2 | 2 | 1 | 0.54 |
| 2 | 2 | 2 | 0.6 |

#### 因子退化
设 X 和 Z 是二值变量，变量 Y 可取 1，2，3 三个值。因子 $\phi(X,Y,Z)$ 如下

| X | Y | Z | $\phi(X, Y, Z)$ |
| :----: | :----: | :----: | :----: |
| 1 | 1 | 1 | 14 |
| 1 | 1 | 2 | 60 |
| 1 | 2 | 1 | 40 |
| 1 | 2 | 2 | 27 |
| 1 | 3 | 1 | 42 |
| 1 | 3 | 2 | 85 |
| 2 | 1 | 1 | 4 |
| 2 | 1 | 2 | 59 |
| 2 | 2 | 1 | 54 |
| 2 | 2 | 2 | 3 |
| 2 | 3 | 1 | 96 |
| 2 | 3 | 2 | 30 |

观察到 Y = 2，求此时的因子 $\psi(X, Y=2, Z)$

| X | Z | $\psi(X, Z)$ |
| :----: | :----: | :----: |
| 1 | 1 | 40 |
| 1 | 2 | 27 |
| 2 | 1 | 54 |
| 2 | 2 | 3 |

#### 因子边缘化
设 X 和 Z 是二值变量，变量 Y 可取 1，2，3 三个值。因子 $\phi(X,Y,Z)$ 如下

| X | Y | Z | $\phi(X, Y, Z)$ |
| :----: | :----: | :----: | :----: |
| 1 | 1 | 1 | 68 |
| 1 | 1 | 2 | 95 |
| 1 | 2 | 1 | 65 |
| 1 | 2 | 2 | 63 |
| 1 | 3 | 1 | 57 |
| 1 | 3 | 2 | 5 |
| 2 | 1 | 1 | 40 |
| 2 | 1 | 2 | 40 |
| 2 | 2 | 1 | 14 |
| 2 | 2 | 2 | 78 |
| 2 | 3 | 1 | 16 |
| 2 | 3 | 2 | 89 |

现在对 X 边缘化，$\psi(Y, Z) = \sum_X \phi(X,Y,Z)$，新的因子如下

| Y | Z | $\psi(X, Z)$ |
| :----: | :----: | :----: |
| 1 | 1 | 108 |
| 1 | 2 | 135 |
| 2 | 1 | 79 |
| 2 | 2 | 141 |
| 3 | 1 | 73 |
| 3 | 2 | 94 |


### 贝叶斯网络
#### 语意 & 因子化
考虑5个随机变量：成绩（G），课程难度（D），学生智力水平（I），学生SAT分数（S），是否有推荐信（L），一个可能的模型如下：

$$
\begin{matrix}
& D & & & & I & \\
& & \searrow & & \swarrow & & \searrow & \\
& & & G & & & &S \\
& & & \downarrow \\
& & & L
\end{matrix}
$$

每一个变量 D、I、G、S、L 的分布如下 P(D) P(I) P(G | I,D) P(S | I) P(L | G)

| $d^{0}$ | $d^{1}$ |
| :----: | :----: |
| 0.6 | 0.4 |

| $i^{0}$ | $i^{1}$ |
| :----: | :----: |
| 0.7 | 0.3 |

|  | $g^{1}(A)$ | $g^{2}(B)$ | $g^{3}(C)$ |
| :----: | :----: | :----: | :----: |
| $i^{0},d^{0}$ | 0.3 | 0.4 | 0.3 |
| $i^{0},d^{1}$ | 0.05 | 0.25 | 0.7 |
| $i^{1},d^{0}$ | 0.9 | 0.08 | 0.02 |
| $i^{1},d^{1}$ | 0.5 | 0.3 | 0.2 |

|  | $s^{0}$ | $s^{1}$ |
| :----: | :----: | :----: |
| $i^{0}$ | 0.95 | 0.05 |
| $i^{1}$ | 0.2 | 0.8 |

|  | $l^{0}$ | $l^{1}$ |
| :----: | :----: | :----: |
| $g^{0}$ | 0.1 | 0.9 |
| $g^{2}$ | 0.4 | 0.6 |
| $g^{2}$ | 0.99 | 0.01 |

联合分布 P(D, I, G, S, L) 是上面分布的组合

$$
\begin{matrix}
& P(D) & & & & P(I) & \\
& & \searrow & & \swarrow & & \searrow & \\
& & & P(G|I,D) & & & & P(S|I) \\
& & & \downarrow \\
& & & P(L|G)
\end{matrix}
$$

例如，根据上表，某一个联合分布的的概率

$$
P(d^{0}, i^{1}, g^{3}, s^{1}, l^{1}) = 0.6 \cdot 0.3 \cdot 0.02 \cdot 0.01 \cdot 0.8
$$

贝叶斯网络（Bayesian Network）是一个有向无环图（DAG），图上每一个节点表示一个随机变量，如 $X_{1}$, $\cdots$, $X_{n}$，并且每一个节点 $X_{i}$ 都有一个条件概率分布 CPD（conditional probability distribution）$P(X_{i} \mid Par_{G}(X_{i}))$，这里允许无父节点。

根据 chain rule 求得贝叶斯网络的联合分布

$$
P(X_{1}, \cdots, X_{n}) = \prod_{i}P(X_{i} \mid Par_{G}(X_{i}))
$$

$$
\sum_{L}P(L \mid G) = 1
$$

联合分布的概率和为1

$$
\begin{aligned}
\sum_{D, I, G, S, L} P(D, I, G, S, L) & = \sum_{D, I, G, S, L} P(D)P(I)P(G \mid I,D)P(S \mid I)P(L \mid G) \\
& = \sum_{D, I, G, S} P(D)P(I)P(G \mid I,D)P(S \mid I)\sum_{L}P(L \mid G) \\
& = \sum_{D, I, G, S} P(D)P(I)P(G \mid I,D)P(S \mid I) \\
& = \sum_{D, I, G} P(D)P(I)P(G \mid I,D)\sum_{S}P(S \mid I) \\
& = \sum_{D, I, G} P(D)P(I)P(G \mid I,D) \\
& = \sum_{D, I} P(D)P(I)\sum_{G}P(G \mid I,D) = \sum_{D, I} P(D)P(I) \\
& = 1
\end{aligned}
$$

如果 G 表示一个图 $X_{1}$, $\cdots$, $X_{n}$，联合概率 P 可以在图上因子化。需要满足如下

$$
P(X_{1}, \cdots, X_{n}) = \prod_{i}P(X_{i} \mid Par_{G}(X_{i}))
$$

```python
D = {0: 0.6, 1: 0.4}
I = {0: 0.7, 1: 0.3}
G = {1: {(0, 0): 0.3, (0, 1): 0.05, (1, 0): 0.9, (1, 1): 0.5},
        2: {(0, 0): 0.4, (0, 1): 0.25, (1, 0): 0.08, (1, 1): 0.3},
        3: {(0, 0): 0.3, (0, 1): 0.7, (1, 0): 0.02, (1, 1): 0.2}}
S = {0: {0: 0.95, 1: 0.2},
        1: {0: 0.05, 1: 0.8}}
L = {0: {1: 0.1, 2: 0.4, 3: 0.99},
        1: {1: 0.9, 2: 0.6, 3: 0.01}}
P = 0
def Prob(d=None, i=None, g=None, s=None, l=None):
    if d is None:
        D_keys = D.keys()
    else:
        D_keys = [d]
    if i is None:
        I_keys = I.keys()
    else:
        I_keys = [i]
    if g is None:
        G_keys = G.keys()
    else:
        G_keys = [g]
    if s is None:
        S_keys = S.keys()
    else:
        S_keys = [s]
    if l is None:
        L_keys = L.keys()
    else:
        L_keys = [l]
    P = 0
    for d in D_keys:
        for i in I_keys:
            for g in G_keys:
                for s in S_keys:
                    for l in L_keys:
                        P += D[d]*I[i]*G[g][(i, d)]*S[s][i]*L[l][g]
    return P
Prob()
```
